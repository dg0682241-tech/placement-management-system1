{% extends "base.html" %}

{% block title %}Manage Students{% endblock %}

{% block content %}
<div class="mb-10 max-w-6xl mx-auto px-4">
    <!-- Page Heading -->
    <h2 class="text-4xl font-extrabold text-black mb-8 text-center animate-fade-in">üë©‚Äçüéì Manage Students</h2>

    <!-- Search Section -->
   <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">

  <!-- Experience -->
  <input list="experienceOptions" type="text" placeholder="Experience" id="searchExperience" class="glass-input">
  <datalist id="experienceOptions">
    <option value="0-1 years">
    <option value="1-2 years">
    <option value="2-3 years">
    <option value="3-5 years">
    <option value="5+ years">
  </datalist>

  <!-- Course -->
  <input list="courseOptions" type="text" placeholder="Course" id="searchCourse" class="glass-input">
  <datalist id="courseOptions">
    <option value="B.Tech">
    <option value="M.Tech">
    <option value="B.Sc">
    <option value="M.Sc">
    <option value="BBA">
    <option value="MBA">
    <option value="Diploma">
  </datalist>

  <!-- Branch -->
  <input list="branchOptions" type="text" placeholder="Branch" id="searchBranch" class="glass-input">
  <datalist id="branchOptions">
    <option value="Computer Science">
    <option value="Electrical">
    <option value="Mechanical">
    <option value="Civil">
    <option value="Electronics">
    <option value="Chemical">
    <option value="Information Technology">
    <option value="Biotechnology">
  </datalist>

  <!-- CGPA / Skill -->
  <input list="cgpaSkillOptions" type="text" placeholder="CGPA / Skill" id="searchCgpaSkill" class="glass-input">
  <datalist id="cgpaSkillOptions">
    <option value="8.0+ CGPA">
    <option value="7.0+ CGPA">
    <option value="6.0+ CGPA">
    <option value="Python">
    <option value="Java">
    <option value="C++">
    <option value="Web Development">
    <option value="Data Science">
    <option value="Machine Learning">
  </datalist>

</div>

    <div class="flex justify-center mb-8">
        <button id="searchBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg transition">Search</button>
    </div>

    <!-- Student Cards -->
    <div id="studentContainer" class="space-y-6">
        {% for s in students %}
        <div class="student-card glass-card p-6 rounded-xl shadow-lg relative" 
             data-eligibility="{{ s['Eperience']|default('') }}" 
             data-course="{{ s['course']|default('') }}" 
             data-branch="{{ s['branch']|default('') }}" 
             data-cgpa="{{ s['cgpa']|default('') }}" 
             data-skills="{{ s['skills']|default('') }}">
            
            <!-- Basic Info -->
            <div class="flex justify-between items-start">
                <div class="space-y-1">
                    <h3 class="text-xl font-bold">{{ s['username'] }}</h3>
                    <p class="text-gray-700">{{ s['email'] }}</p>
                </div>
                <div class="flex gap-2">
                    <button class="details-btn bg-green-500 hover:bg-green-600 text-white px-4 py-1 rounded transition">Details</button>
                    <button class="remove-btn bg-red-500 hover:bg-red-600 text-white px-4 py-1 rounded transition">Remove</button>
                </div>
            </div>

            <!-- Fields shown based on search -->
            <div class="mt-4 grid grid-cols-2 gap-4">
                <p class="field experience"><span class="font-bold">Experience:</span> {{ s['experience']|default('N/A') }}</p>
                <p class="field course"><span class="font-bold">Course:</span> {{ s['course']|default('N/A') }}</p>
                <p class="field branch"><span class="font-bold">Branch:</span> {{ s['branch']|default('N/A') }}</p>
                <p class="field cgpa-skill"><span class="font-bold">CGPA / Skills:</span> {{ s['cgpa']|default('') }} / {{ s['skills']|default('') }}</p>
            </div>

            <!-- Details Panel -->
            <div class="details-panel mt-4 p-4 rounded-lg bg-white/50 shadow-lg hidden">
                <h4 class="font-bold text-lg mb-2">Profile Info:</h4>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <p><span class="font-bold">Username:</span> {{ s['username'] }}</p>
                    <p><span class="font-bold">Email:</span> {{ s['email'] }}</p>
                    <p><span class="font-bold">Phone:</span> {{ s['phone']|default('N/A') }}</p>
                    <p><span class="font-bold">Gender:</span> {{ s['gender']|default('N/A') }}</p>
                    <p><span class="font-bold">Course:</span> {{ s['course']|default('N/A') }}</p>
                    <p><span class="font-bold">Branch:</span> {{ s['branch']|default('N/A') }}</p>
                    <p><span class="font-bold">Passing Year:</span> {{ s['passing_year']|default('N/A') }}</p>
                    <p><span class="font-bold">CGPA:</span> {{ s['cgpa']|default('N/A') }}</p>
                    <p class="col-span-2"><span class="font-bold">Bio:</span> {{ s['bio']|default('N/A') }}</p>
                    <p><span class="font-bold">LinkedIn:</span> <a href="{{ s['linkedin']|default('#') }}" target="_blank">{{ s['linkedin']|default('N/A') }}</a></p>
                    <p><span class="font-bold">GitHub:</span> <a href="{{ s['github']|default('#') }}" target="_blank">{{ s['github']|default('N/A') }}</a></p>
                </div>

                <h4 class="font-bold text-lg mb-2">Applications:</h4>
                <table class="w-full text-sm border-collapse border border-gray-300">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="border px-2 py-1">Company</th>
                            <th class="border px-2 py-1">Role</th>
                            <th class="border px-2 py-1">Status</th>
                            <th class="border px-2 py-1">Applied At</th>
                            <th class="border px-2 py-1">Skills</th>
                            <th class="border px-2 py-1">Resume</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for a in s['applications'] %}
                        <tr>
                            <td class="border px-2 py-1">{{ a['company'] }}</td>
                            <td class="border px-2 py-1">{{ a['role'] }}</td>
                            <td class="border px-2 py-1">{{ a['status'] }}</td>
                            <td class="border px-2 py-1">{{ a['applied_at'] }}</td>
                            <td class="border px-2 py-1">{{ a['skills'] }}</td>
                          <td class="border px-2 py-1 text-center">
  {% if a['resume'] %}
    <a href="{{ url_for('static', filename='uploads/resumes/' ~ a['resume']) }}"
       class="resume-btn"
       download>
      Download
    </a>
  {% else %}
    <span class="text-muted">N/A</span>
  {% endif %}
</td>

                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
/* Glass input */
.glass-input {
    background: rgba(255,255,255,0.4);
    backdrop-filter: blur(10px);
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.6);
    outline: none;
    font-size: 14px;
}

/* Card glass effect */
.glass-card {
    background: rgba(255,255,255,0.4);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.3);
}

/* Highlighted field */
.field.highlight {
    background: #fef3c7;
    border-radius: 5px;
    padding: 1px 3px;
}
    .resume-btn {
  background: #2563eb;
  color: white;
  padding: 4px 12px;
  border-radius: 999px;
  font-size: 13px;
  font-weight: 600;
  border: 2px solid #1d4ed8;
  transition: all 0.3s ease;
}

.resume-btn:hover {
  background: #1d4ed8;
  transform: scale(1.08);
}


/* Animation fade in */
@keyframes fadeIn { from {opacity:0} to {opacity:1} }
.animate-fade-in { animation: fadeIn 0.8s ease forwards; }

/* Remove button animation */
.student-card.removed { animation: fadeOut 0.5s ease forwards; opacity:0; height:0; margin:0; padding:0; }
@keyframes fadeOut { from {opacity:1;height:auto} to {opacity:0;height:0} }
    /* ================= MOBILE RESPONSIVENESS FIX ================= */
/* ================= MOBILE RESPONSIVENESS (FINAL) ================= */
@media (max-width: 768px) {

  /* Prevent page-level horizontal scroll */
  body {
    overflow-x: hidden;
  }

  /* Page heading */
  h2 {
    font-size: 1.9rem;
    line-height: 1.3;
    margin-bottom: 1.5rem;
  }

  /* Search inputs */
  .glass-input {
    font-size: 13px;
    padding: 8px 10px;
    width: 100%;
  }

  /* Student card */
  .student-card {
    padding: 14px !important;
    max-width: 100%;
    overflow: hidden;
  }

  /* Header section stack */
  .student-card > div:first-child {
    flex-direction: column;
    gap: 10px;
  }

  /* Buttons full-width */
  .student-card .flex.gap-2 {
    width: 100%;
    flex-direction: column;
  }

  .student-card button {
    width: 100%;
    font-size: 14px;
  }

  /* Fields grid ‚Üí single column */
  .student-card .grid.grid-cols-2 {
    grid-template-columns: 1fr !important;
    gap: 8px;
  }

  /* ================= DETAILS PANEL ================= */

  .details-panel {
    width: 100%;
    max-width: 100%;
    padding: 12px;
    overflow-x: auto;
    overflow-y: hidden;
    box-sizing: border-box;
  }

  /* Profile info grid ‚Üí single column */
  .details-panel .grid.grid-cols-2 {
    grid-template-columns: 1fr !important;
    gap: 8px;
  }

  /* ================= APPLICATIONS TABLE ================= */

  .details-panel table {
    display: block;
    width: 100%;
    max-width: 100%;
    table-layout: fixed;
    border-collapse: collapse;
  }

  .details-panel thead,
  .details-panel tbody {
    display: table;
    width: 100%;
  }

  .details-panel th,
  .details-panel td {
    font-size: 12px;
    padding: 6px;
    white-space: normal;
    word-break: break-word;
    text-align: left;
  }
}

</style>

<script>
// Search and highlight
const searchBtn = document.getElementById('searchBtn');
searchBtn.addEventListener('click', () => {
    const eligibility = document.getElementById('searchEligibility').value.toLowerCase();
    const course = document.getElementById('searchCourse').value.toLowerCase();
    const branch = document.getElementById('searchBranch').value.toLowerCase();
    const cgpaSkill = document.getElementById('searchCgpaSkill').value.toLowerCase();

    const cards = document.querySelectorAll('.student-card');

    cards.forEach(card => {
        let match = false;
        // Reset highlights
        card.querySelectorAll('.field').forEach(f => f.classList.remove('highlight'));

        // Fields
        const fEligibility = card.dataset.eligibility.toLowerCase();
        const fCourse = card.dataset.course.toLowerCase();
        const fBranch = card.dataset.branch.toLowerCase();
        const fCgpa = card.dataset.cgpa.toLowerCase();
        const fSkills = card.dataset.skills.toLowerCase();

        // Check each
        if (eligibility && fEligibility.includes(eligibility)) {
            card.querySelector('.field.eligibility').classList.add('highlight'); match=true;
        }
        if (course && fCourse.includes(course)) {
            card.querySelector('.field.course').classList.add('highlight'); match=true;
        }
        if (branch && fBranch.includes(branch)) {
            card.querySelector('.field.branch').classList.add('highlight'); match=true;
        }
        if (cgpaSkill && (fCgpa.includes(cgpaSkill) || fSkills.includes(cgpaSkill))) {
            card.querySelector('.field.cgpa-skill').classList.add('highlight'); match=true;
        }

        // Show card only if any field matches or search is empty
        if (!eligibility && !course && !branch && !cgpaSkill) {
            card.style.display = 'block';
        } else {
            card.style.display = match ? 'block' : 'none';
        }
    });
});

// Details toggle
document.querySelectorAll('.details-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
        const card = e.target.closest('.student-card');
        const panel = card.querySelector('.details-panel');
        panel.classList.toggle('hidden');
    });
});

// Remove card animation
document.querySelectorAll('.remove-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
        const card = e.target.closest('.student-card');
        card.classList.add('removed');
        setTimeout(()=> card.remove(), 500);
    });
});
</script>

{% endblock %}








